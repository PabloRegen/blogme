extends ../layouts/layout

block title
	|read post

block content
	article
		div.readingWidth
			div.userInfo.paddingTop30.paddingBottom30
				if postedByUser.pic != null
					img.userPic.marginRight15(src=`/uploads/${postedByUser.pic}`)
				else
					img.userPic.marginRight15(src='/images/avatar.jpg')

				div
					if postedByUser.name != null
						div.userName #{postedByUser.name}
					else
						div.userName #{postedByUser.username}

					if postedByUser.bio != null
						div.userBio #{postedByUser.bio}

					div.postedAt #{moment(post.postedAt).format('ll')}

				div.clear

			h1.postTitle!= sanitizer.sanitize(post.title)
			h2.postSubtitle!= sanitizer.sanitize(post.subtitle)

		if post.pic != null
			img.postCoverImage(src=`/uploads/${post.pic}`, alt='Alt post pic', title='Main Post Pic')

		div.readingWidth
			div.postBody!= sanitizer.sanitize(postBody, function(url) { return url; })

			if canEditAndDelete
				div.editDeletePost.flex-row
					a.customButton(href=`/posts/${slug}/edit`) Edit post
					form(action=`/posts/${slug}/delete` method='post')
						input.danger(type='submit' value='Delete post')

			div
				if alreadyLikedPost
					// user logged-in and already liked post
					form.likePost(action=`/posts/${slug}/unlike` method='post')
						button.heart(type='submit')
							i.icon-heart
				else	
					// user not logged-in or not liked post yet
					form.likePost(action=`/posts/${slug}/like` method='post')
						button.heart(type='submit' disabled=(!canLike))
							i.icon-heart 
				| #{likes}

			div.tags.flex-row
				if tags.length > 0
					i.icon-tag
					| Tags:
					each tag in tags
						span #{tag}

			div.userInfo.paddingBottom30
				if postedByUser.pic != null
					img.userPic(src=`/uploads/${postedByUser.pic}`)
				else
					img.userPic(src='/images/avatar.jpg')

				if postedByUser.name != null
					div.userName #{postedByUser.name}

				if postedByUser.bio != null
					div.userBio #{postedByUser.bio}

				if alreadyFollowing
					// user logged-in and already following post's author
					form(action=`/accounts/${post.userId}/unfollow?redirectToPost=${slug}` method='post')
						input(type='submit' value='Unfollow')
				else
					// user not logged-in or not following post's author yet
					form(action=`/accounts/${post.userId}/follow?redirectToPost=${slug}` method='post')
						input(type='submit' value='Follow' disabled=(!canFollow))

				| #{follows}

				div.clear